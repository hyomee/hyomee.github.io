# 에러처리

배치 작업에서 예외 및 에러에 의해서 중단이 되면 전체를 다시 수행해야해야 한다. 이것은 처리하는 업무의 특성에 따라 틀려지지만 일반적으로 대량의 데이터를 처리하는 일에서는 문제있는 데이터를 제외 한 나머지는 정상 처리가 되도록 해야한다. 스프링 배치에서는 이런 예외 처리를 위한 후크를 제공하고 있다.

## 1. 예외 처리 전략

* **Retry**: 실패한 단계 또는 작업을 성공할 때까지 여러번 수행하는 전략으로 재시도 횟수와 재시도 사이에 사용할 백오프 정책을 지정하는RetryTemplate 또는 RetryOperationsInterceptor 클래스를 사용하여 단계 또는 작업을 재시도할 횟수를 구성할 수 있다.
  * Step 요소의 **faultTolerant** 속성을 true로 설정
  * 연결 시간 초과 또는 네트워크 오류와 같은 일시적인 문제로 인해 실패한 경우에 유용
* **Skip**: 실패한 항목을 무시하고 진행하는 전략으로 결함이 있는 입력 레코드를 발견하는 즉시 배치 처리를 건너뛸지 아니면 실패할지를 결정하는  SkipPolicy 또는 SkipListener 인터페이스를 사용하여 단계 또는 작업 수준에서 스킵 로직을 구성할 수 있다.
  * Step 요소의 **faultTolerant** 속성을 true로 구성
  * 실패가 전체 처리 로직에 영향을 미치지 않는 알려진 문제로 인한 것일 때 유용
* **Write**:  실패한  항목을 추적하여 파일또는 DB에 저장 하는 전역으로 ChunkListener 또는 SkipListener 인터페이스를 사용하여 예외 처리를 구성할 수 있다.
* **Notification**:  실패한  항목을 이메일이나 SMS를 통해서 통보하는 전략으로 TaskletStep 또는 ChunkListener 클래스를 사용하여 이메일을 보내도록 예외 처리를 구성할 수 있다.
* **Rollback**:  일괄 처리 중 오류가 발생하면 트랜잭션을 롤백하는 오류 처리 전략으로 예외가 발생할 때 트랜잭션을 자동으로 롤백한다.
  * Step 요소의 rollback 속성을 true로 지정
  * 트랜잭션이 분할할 수 없고 모든 관련 작업이 전체적으로 성공하거나 실패해야 하는 경우에 유용
* **Terminate**: 오류가 발생하면 배치 처리를 종료하는 오류 처리 전략으로 문제 발생시 배치를 종료한다.
  * Step 요소의 failOnTimeout 속성을 true로 지정
  * 오류가 심각하여 현재 작업 및 전체 배치 처리가 무의미해질 때 유용
* **Partition**: 대규모 배치 작업을 더 작은 독립적인 파티션으로 분할하여 각 파티션이 다른 파티션과 독립적으로 처리될 수 있도록 하는 오류 처리 전략으로 파티션으로 분할하는 방법과 각 파티션의 결과를 처리하는 방법을 지정하는 PartitionHandler 구현에 Job 요소의 partitionHandler 속성을 구성하여 스프링 배치에서 파티셔닝을 적용할 수 있다,
  * 데이터의 양이 너무 커서 단일 프로세서로 처리할 수 없거나 작업의 각 부분에 서로 다른 처리 용량이 필요할 때 유용

## 2. 오류 처리 구현&#x20;

배치 처리 작업의 수명 주기 동안 발생하는 이벤트를 처리하는 자바 클래스인 Listener를 사용하여 구현한다. \[ SkipListener, RetryListener, ChunkListener , StepExecutionListener, JobExecutionListener 등 )&#x20;
