# 알림시스템

알림 시스템은 사용자에게 중요한 정보를 전달하고 효율적인 상호작용을 지원하는 핵심 기능입니다. 알림 유형에는 이메일 알림, SMS 메시지 알림, 모바일 푸시 알림 등이 있습니다.

* **정보 알림**: 날씨 경보, 교통 업데이트, 속보 등을 포함하여 실시간으로 변경되거나 새로운 데이터를 사용자에게 제공하는 알림
* **예정 알림**: 캘린더 이벤트, 청구서 결제 알림, 구독 갱신 등 예정된 메세지에 대해서 사용자에게 제공하는 알림
* **프로모션 알림**: 제품, 서비스, 특별 제안을 홍보하기 위해  사용자에게 제공하는 알림
* **사용자 행동 유도 알림**:  댓글, 좋아요 등 리액션을 통해 사용자를 참여시키는 알림

## 1. 설계 고려 사항

알림 시스템은 알림의 종류, 고객의 요구, 그리고 시스템의 자원에 따라 다양할 수 있지만, 일반적으로 구축하기 전에 고려해야 할 핵심 시스템 설계 요소들은 다음과 같습니다.

* **알림 유형 지원 방안**: 알림 시스템은 다양한 유형의 알림을 지원해야 합니다. 이는 푸시 알림, SMS 메시지, 이메일 등을 포함합니다.
* **실시간 시스템 여부**: 알림 시스템은 실시간으로 동작해야 하는지 여부를 고려해야 합니다. 연속적인 알림이 필요한 경우 실시간 시스템으로 설계되어야 합니다.
* **단말 지원**: 어떤 종류의 단말을 지원할 것인지 결정해야 합니다. iOS, 안드로이드, 랩톱/데스크톱 등 다양한 플랫폼을 고려해야 합니다.
* **알림 생성 주체**: 알림을 생성하는 주체는 클라이언트 어플리케이션 프로그램이나 서버측에서 스케줄링할 수 있습니다.
* **사용자 설정**: 사용자가 알림을 받지 않도록 설정할 수 있어야 합니다. 알림 종류마다 수신 허용/거부 기능을 제공해야 합니다.
* **전송률 제한**: 사용자가 너무 많은 알림을 받아서 알림 자체를 끄지 않도록 제한하는 방법이 필요합니다
* **데이터 암호화**: 알림 메시지에 포함된 민감한 정보를 암호화하여 보호해야 합니다. 특히 SMS나 이메일과 같은 통신 채널을 통해 전송되는 알림은 암호화되어야 합니다.
* **인증 및 권한 관리**: 알림을 생성하고 전송하는 주체를 인증하고 권한을 관리해야 합니다. 알림 제공자와 사용자 간의 신뢰성을 확인하고 알림을 보낼 수 있는 권한을 제한해야 합니다.
* **알림 로깅 및 감사**: 알림 발송 기록을 로그로 남겨야 합니다. 이를 통해 알림 전송 이력을 추적하고 필요한 경우 감사할 수 있습니다.
* **알림 유출 방지**: 알림 메시지가 누출되지 않도록 보호해야 합니다. 예를 들어, 알림을 표시하는 화면이 다른 사람에게 보이지 않도록 주의해야 합니다.
* **알림 전송 속도 제한**: 과도한 알림을 방지하기 위해 전송 속도를 제한하는 메커니즘이 필요합니다

## 2. 시스템 범위 확정

시스템 구축의 첫번째 단계는 범위에 대한 것으로 구축하고자하는 시스템의 범위를 결정하는 것 입니다. 만약 고객에게 의뢰를 받아서 하는 만드는 시스템이라면 고객의 요구사항에 대한 범위를 확정한 설계를 해야 만족하는 시스템을 만들 수 있습니다. 다음은 구축하고자 하는 시스템의 범위 입니다.

* 사용자 정보 수집: 일반적으로 사용자 정보 수집은 회원 가입, 마겟팅 동의, 구독 신청 등을 통해서 기본 정보를 받아 DB에 저장 합니다.
* 알림 지원 유형: 알림은 이메일, SMS, PUSH(안드로이드,  아이폰)을 사용자가 복수로 선택할 수 있어야 합니다.
* 알림 템플릿: 사전에 정의된 메시지를 사용하여 일관된 메시지를 보내기 위해 템플릿  기능을 제공한다.또한문구 사이에 $name 또는 \[name] 형식으로 동적 데이터를 삽입할 수 있도록 정의해야 합니다.
* 전송률 제한: 알림 사용자가 알림을 받을지 말지에 대해서 선택 할 수 있는 기능을 제공합니다.
* 재 처리:  알림 발송 실패시 재처리 기능을 n회 제공 합니다.
* 알림 보안: 알림은 인증 된 사용자에게만 발송을 해야 합니다.&#x20;
* 알림 이벤트 추적: 알림은 발송 대기 부터 사용자가 수신 한 것 까지의 각 단계에 따른 이벤트를 추적해야 합니다.
* 성능: 알림은 대량 사용자에게 발송을 하므로 알림 발송량에 따라 확장이 가능해야 합니다.
* 알림 예약: 알림은 실시간 알림, 예약 알림이 구분되어야 하고 사용자가 설정한 시간에만 받도록 해야 합니다.

작성된 시스템의 범위는 일반적인 사항으로 하나씩 풀어 나가는 방식으로 설계를 합니다.

## 3. 시스템 설계

### 3-1. 사용자 정보 수집

사용자 수집은 일반적으로 사용자 정보 수집은 회원 가입, 마겟팅 동의, 구독 신청 등을 통해서 기본 정보를 받는 과정으로 다음과 같은 경로로 받아 DB에 저장 합니다.

<figure><img src="../../.gitbook/assets/image (11).png" alt=""><figcaption><p>사용자 수집</p></figcaption></figure>

* 회원 가입시 마켓팅 동의한 회원 정보
* 웹 사이트에서 정보 수신을 위한 이메일 또는 SMS 정보를 등록한 사용자
* 앱 설치 후 PUSH 동의를 한 사용자&#x20;

### 3-2. 알림 지원 유형에 따른 알림

알림 지원 유형에 따라서 필요한 알림 처리를 하는 자원은 다음과 같습니다.

<figure><img src="../../.gitbook/assets/image (13).png" alt="" width="563"><figcaption></figcaption></figure>

* 이메일: 이메일 서비스&#x20;
* SMS: SMS 서비스&#x20;
* PUSH: 안드로이드는 FCM(Firebase Cloud Messaging), 아이폰은 APNS(Apple Push Notification Service)
* 3자 서비스 제공자: 이메일 또는 SMS 서비스가 없는 사용자는 업체에서 제공하는 서비스를 통해서 알림을 발송합니다.

### 3-3. 알림 템플릿

이메일, SMS, PUSH는 다수의 사용자에게 메시지를 전달하는 기능이며, 다양한 유형의 템플릿을 생성하여 사용자에게 적합한 메시지를 보낼 수 있습니다. 메시지에는 이름이나 특별한 문구 등을 동적으로 반영하기 위해 ${}\[표현 언어(Expression Language, EL)]를 사용하여 바인딩합니다.

* 예: 홍길동님 예약 시간은 2024년 6월 22일 12시 입니다.
  * ${name}님 예약 시간은${reserveDate}입니다.

### 3-3. 재 처리

연동 시스템은 크게  일반적으로 다음 포인트에서 오류가 발생하며 그에 대한 재처리 방안입니다.

<figure><img src="../../.gitbook/assets/image (9).png" alt=""><figcaption><p>일반적인 재처리</p></figcaption></figure>

* 서비스 서버 오류: 서비스 서버 오류는 다양한 유형이 있지만, 대부분의 경우 서버에서 오류가 발생하면 즉시 재처리하지 않고 배치 또는 데몬을 통해 재처리합니다..
* 서비스 제공자 관련 오류: 서비스 제공자에 위한 오류는 일반적으로 다음과 같은 오류가 발생합니다.
  * 서비스 서버와 제공자 연동 오류: 서비스 서버에서 제공자 서비스로 데이터를 전송하는 도중 오류가 발생하면, 정책에 따라 즉시 재처리를 진행합니다. 물론, 재처리 횟수를 설정할 수 있으며, 오류가 설정한 횟수를 초과하면 해당 건은 재처리하지 않고 배치(또는 데몬)를 이용하여 처리합니다.
  * 제공자 서비스 내부 오류: 제공자 서비스가 사용자에게 메시지를 발송하지 못하는 경우, 서비스 서버로부터 결과를 받지 못하면 재처리는 불가능합니다. 최종 사용자가 메시지를 수신할 때 반환되는 정보를 기반으로 재처리할 수 있으나, 그러한 정보가 없을 경우 재처리할 방법이 없습니다. 그러나 제공자 서비스가 결과를 서비스 서버로 전달한다면, 정책에 따라 실시간으로 재처리하거나 배치(또는 데몬)를 이용하여 재처리할 수 있습니다.

### 3-4. 알림 이벤트 추적



